<!DOCTYPE html>
<html lang="en">
  	<head>
		    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> :: AsciiDoc</title>
    <meta name="generator" content="Antora 3.1.7">

<link rel="stylesheet" href="../../../../_/css/site.css">

<link rel="stylesheet" href="../../../../_/css/vendor/asciidoc.css">

<link rel="stylesheet" href="../../../../_/css/vendor/extra.css">

<link rel="stylesheet" href="../../../../_/css/vendor/vs.css">

<link rel="stylesheet" href="../../../../_/css/vendor/prism-1.29.0-coy.css">


    <link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  	</head>
  	
  	<body class="article">
		<header class="header">
	<nav class="navbar">
    	<div class="navbar-brand">
  			
  			<a class="navbar-item logo" target="_blank" href="">
				<img src="../../../../_/img/yin-yang-symbol.svg" width="100%" height="50">
			</a>
  			
	            <div id="main" style="place-content: center;">
	                    <input id="search-input" type="text" placeholder="Type for Retrieving...">
		            </div>
		        </section>
    	</div>
    	
    	<div id="topbar-nav" class="navbar-menu">
      		<div class="navbar-end">
				<div class="navbar-item has-dropdown is-hoverable">
          			<div class="navbar-link">Culture</div>
          			<div class="navbar-dropdown is-right">
            			
			            <div class="navbar-item">Traditional Culture</div>
			            
			            <a class="navbar-item" target="_blank" href="../../../../culture/v0.0.1/index.html">
			            	<span class="icon"><img src="../../../../_/img/octicons-16.svg"></span>
	              			<span>Culture <small>传统文化</small></span>
			            </a>
        			</div>
    			</div>
    			
				<div class="navbar-item has-dropdown is-hoverable">
          			<div class="navbar-link">Eco</div>
          			
          			<div class="navbar-dropdown is-right">
			            <a class="navbar-item" target="_blank" href="../../../../multifariousness/v0.0.1/index.html">
			            	<span class="icon"><img src="../../../../_/img/octicons-16.svg"></span>
	              			<span>Multifariousness <small>五花八门</small></span>
			            </a>

			            <hr class="navbar-divider">
			            <a class="navbar-item" target="_blank" href="../../../../ai/v0.0.1/index.html">
			            	<span class="icon"><img src="../../../../_/img/octicons-16.svg"></span>
	              			<span>Artificial Intelligence<small>人工智能</small></span>
			            </a>
			            
			            <hr class="navbar-divider">
			            <a class="navbar-item" target="_blank" href="../../../../msg/v0.0.1/index.html">
			            	<span class="icon"><img src="../../../../_/img/octicons-16.svg"></span>
	              			<span>Messaging - Kafka <small>Kafka</small></span>
			            </a>
        			</div>
    			</div>
    			
				<div class="navbar-item has-dropdown is-hoverable">
          			<div class="navbar-link">Experiment</div>
          			
          			<div class="navbar-dropdown is-right">
			            <div class="navbar-item">Quantum Computing</div>
			            
			            <a class="navbar-item" href="#">
			            	<span class="icon"><img src="../../../../_/img/octicons-16.svg"></span>
	              			<span>QC <small>量子计算...</small></span>
			            </a>
			            
			            <hr class="navbar-divider">
			            <div class="navbar-item">Harmony</div>
			            
			            <a class="navbar-item" href="#">
			            	<span class="icon"><img src="../../../../_/img/octicons-16.svg"></span>
	              			<span>CangJie <small>预览版内测...</small></span>
			            </a>
        			</div>
    			</div>
      		</div>
    	</div>
	</nav>
</header>
		<div class="body">
	<div class="nav-container" data-component="multifariousness" data-version="v0.0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../../index.html">Multifariousness</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Security/KeycloakInstallation.html">Keycloak Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Security/KeycloakCase.html">Keycloak Case</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Antora</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/AsciidoctorInstallation.html">Asciidoctor Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/AsciidoctorConfigurer.html">Asciidoctor Configurer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/AntoraInstallation.html">Antora Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/AntoraConfigurer.html">Antora Configurer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/AntoraHighlight.html">Antora Highlight</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/AntoraUI.html">Antora UI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/Markdown.html">Markdown</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Antora/NodeInstallation.html">Node Installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Doxygen</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/DoxygenInstallation.html">Doxygen Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/DoxygenEntry.html">Doxygen Entry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/DocumentingCode.html">Documenting Code</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/DoxygenUsage.html">Doxygen Usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/DoxywizardUsage.html">Doxywizard Usage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/DoxyfileProperty.html">Doxyfile Property</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/CustomCommand.html">Custom Command</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/SpecialCommand.html">Special Command</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/HtmlCommand.html">Html Command</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/XmlCommand.html">Xml Command</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Doxygen/EmojiSupport.html">Emoji Support</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lang</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/RustPrerequisite.html">Rust Prerequisite</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/RustGun.html">Rust Gun</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/RustConfigurer.html">Rust Configurer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/RustEclipse.html">Rust Eclipse</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/RustVSCode.html">Rust VSCode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/GoInstallation.html">Go Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/GroovyInstallation.html">Groovy Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/JavaFxInstallation.html">JavaFx Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/LuaInstallation.html">Lua Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Lang/PythonInstallation.html">Python Installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ide</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ide/EclipseCustomizer.html">EclipseCustomizer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ide/EclipseConfigurer.html">EclipseConfigurer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ide/FlattenLifecycle.html">FlattenLifecycle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ide/JakartaSpecification.html">JakartaSpecification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ide/CondaJupyter.html">CondaJupyter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ide/IdeaConfigurer.html">IdeaConfigurer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Ops</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/HyperVConfigurer.html">Hyper VConfigurer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/UbuntuConfigurer.html">Ubuntu Configurer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/DockerFundamental.html">Docker Fundamental</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/K8SInstallation.html">K8S Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/K8SExtension.html">K8S Extension</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/NexusInstallation.html">Nexus Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/JenkinsInstallation.html">Jenkins Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/BatchProcess.html">Batch Process</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/OracleContainerRegistry.html">Oracle Container Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Ops/WinConfigurer.html">Win Configurer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Msg</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="KafkaInstallation.html">Kafka Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="KafkaEntryCase.html">Kafka Entry Case</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="PulsarInstallation.html">Pulsar Installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Store</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/PowerDesigner.html">Power Designer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/CassandraSetup.html">Cassandra Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/CassandraBoot.html">Cassandra Boot</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/CassandraTesting.html">Cassandra Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/ElasticInstallation.html">Elastic Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/ElasticCase.html">Elastic Case</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/OpenSearchInstallation.html">Open Search Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/MySQLInstallation.html">MySQL Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/MySqlTuning.html">MySql Tuning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/MongoInstallation.html">Mongo Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/MongoCase.html">Mongo Case</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/PostgresInstallation.html">Postgres Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/AeroSpikeInstallation.html">Aero Spike Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../Store/TinkerpopCase.html">Tinkerpo pCase</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Multifariousness</span>
    <span class="version">v0.0.1</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../../ai/v0.0.1/index.html">AI</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../ai/v0.0.1/index.html">v0.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../../index.html">Multifariousness</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">v0.0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
	<main class="article">
	<div class="toolbar" role="navigation">
	<button class="nav-toggle"></button>
	
		<a href="../../index.html" 
			class="home-link">
		</a>

	<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Multifariousness</a></li>
    <li>Msg</li>
    <li><a href="KafkaInstallation.html">Kafka Installation</a></li>
  </ul>
</nav>
		</div>
	
	<div class="content">
			<aside class="toc sidebar" 
	data-title="Contents" 
	data-levels="2">
  <div class="toc-menu"></div>
</aside>
			<article class="doc">
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#_prerequisite">1. Prerequisite</a></li>
<li><a href="#_property_variable">2. Property Variable</a></li>
<li><a href="#_generate_clusterid">3. Generate ClusterId</a></li>
<li><a href="#_environment_variable">4. Environment Variable</a></li>
<li><a href="#_schema_registry">5. Schema Registry</a></li>
<li><a href="#_docker_compose">6. Docker Compose</a></li>
<li><a href="#_kraft_server_properties">7. KRaft server.properties</a></li>
<li><a href="#_install_on_linux">8. Install On Linux</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_prerequisite"><a class="anchor" href="#_prerequisite"></a>1. Prerequisite</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>镜像选择：apache/kafka:3.8.0或confluentinc/cp-kafka:7.6.1</p>
</li>
<li>
<p>schema-registry可选，docker compose up -d；</p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc/" class="bare">https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc/</a></p>
</li>
<li>
<p>不建议Windows下使用KRaft模式，如可能无法删除主题等诸多问题；</p>
</li>
<li>
<p>常用工具：kafkatool，conduktor，kafka-eagle，PrettyZoo，</p>
</li>
<li>
<p>docker pull quay.io/strimzi/kafka:0.40.0-kafka-3.8.0</p>
</li>
<li>
<p><a href="https://meta.wikimedia.org/wiki/Our_projects" class="bare">https://meta.wikimedia.org/wiki/Our_projects</a></p>
</li>
<li>
<p><a href="https://wikitech.wikimedia.org/wiki/Event_Platform" class="bare">https://wikitech.wikimedia.org/wiki/Event_Platform</a></p>
</li>
<li>
<p><a href="https://github.com/wikimedia/mediawiki-extensions" class="bare">https://github.com/wikimedia/mediawiki-extensions</a></p>
</li>
<li>
<p><a href="https://github.com/wikimedia/mediawiki-services-eventstreams" class="bare">https://github.com/wikimedia/mediawiki-services-eventstreams</a></p>
</li>
<li>
<p><a href="https://github.com/didi/KnowStreaming" class="bare">https://github.com/didi/KnowStreaming</a></p>
</li>
<li>
<p><a href="https://www.wikimedia.org" class="bare">https://www.wikimedia.org</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_property_variable"><a class="anchor" href="#_property_variable"></a>2. Property Variable</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stripes-even fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Configuration Property</th>
<th class="tableblock halign-left valign-top">Environment Variable</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">.(abc.def)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_(KAFKA_ABC_DEF)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">_(abc_def)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">__(double underscore，KAFKA_ABC__DEF)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">-(abc-def)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>_</em>(triple underscore，KAFKA_ABC___DEF)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_generate_clusterid"><a class="anchor" href="#_generate_clusterid"></a>3. Generate ClusterId</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># generate  clusterId

./kafka-storage.sh random-uuid

cat /proc/sys/kernel/random/uuid | tr -d '-' | base64 | cut -b 1-22

uuidgen --time | tr -d '-' | base64 | cut -b 1-22</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_environment_variable"><a class="anchor" href="#_environment_variable"></a>4. Environment Variable</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><mark>KAFKA_NODE_ID</mark>：Kafka节点唯一标识(uniquely identifying)；</p>
</li>
<li>
<p><mark>KAFKA_CONTROLLER_LISTENER_NAMES</mark>：<br>
控制器名称，逗号分隔，KRaft模式必须设置，因默认PLAINTEXT协议；</p>
</li>
<li>
<p><mark>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</mark>：<br>
将监听器名称映射到响应的安全协议，为未经身份认证且未加密的PLAINTEXT<br>
安全协议分配三个监听器(CONTROLLER，INTERNAL，EXTERNAL)；</p>
</li>
<li>
<p><mark>KAFKA_LISTENERS</mark>：服务器监听的地址</p>
<div class="ulist">
<ul>
<li>
<p><mark>CONTROLLER</mark>：controller quorum communication；</p>
</li>
<li>
<p><mark>INTERNAL</mark>：internal communication between DATA PLANE broker<br>
及与broker位于同一网络上的客户端(如Schema Registry)；</p>
</li>
<li>
<p><mark>EXTERNAL</mark>：用于与broker网络外部的客户端通信，<br>
如连接到Docker中运行的Kafka集群的计算机上运行的应用程序；</p>
</li>
</ul>
</div>
</li>
<li>
<p><mark>KAFKA_ADVERTISED_LISTENERS</mark>：<br>
address advertised to client，若未设置，则默认KAFKA_LISTENERS；</p>
</li>
<li>
<p><mark>KAFKA_CONTROLLER_QUORUM_VOTERS</mark>：</p>
<div class="ulist">
<ul>
<li>
<p>逗号分隔的controller voter(控制器投票者)列表；</p>
</li>
<li>
<p>格式：{controllerId}@{controllerHost}:{controllerPort}；</p>
</li>
<li>
<p>quorum中controller使用29093端口；</p>
</li>
</ul>
</div>
</li>
<li>
<p><mark>KAFKA_PROCESS_ROLES</mark>：指定节点的角色：broker，controller，both；</p>
</li>
<li>
<p><mark>CLUSTER_ID</mark>：集群的唯一16字节Base64 Uuid；</p>
</li>
<li>
<p><mark>KAFKA_LOG_DIRS</mark>：存储日志文件的以逗号分隔的目录列表；</p>
</li>
<li>
<p><mark>KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS</mark>：<br>
当第一个成员(member)加入空组(empty group)时，GroupCoordinator<br>
用于启动初始重新平衡(start initial rebalance)的延迟(delay)；</p>
</li>
<li>
<p><mark>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</mark>：<br>
__kafka_offsets的复制因子，该主题存储提交的偏移量，<br>
默认为1，但我们在3个broker集群中调整为3；</p>
</li>
<li>
<p><mark>KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR</mark>：</p>
<div class="ulist">
<ul>
<li>
<p>__transaction_state的复制因子，<br>
该主题存储事务状态，并在第一次请求事务Api时自动创建；</p>
</li>
<li>
<p>复制因子是节点的数量，包括Leader；</p>
</li>
<li>
<p>主机端口9092，9093，9094映射到容器的端口9092，<br>
使broker网络外部的Kafka客户端能够连接到集群；</p>
</li>
</ul>
</div>
</li>
<li>
<p>每个Kafka节点的其它KRaft属性可使用server.properties配置，<br>
在Docker Compose中设置属性时，请记住使用"KAFKA_"前缀；</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_schema_registry"><a class="anchor" href="#_schema_registry"></a>5. Schema Registry</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><mark>SCHEMA_REGISTRY_HOST_NAME</mark>：advertised host name，<br>
Schema Registry的多个实例间相互通信(intercommunication)所必须；</p>
</li>
<li>
<p><mark>SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</mark>：<br>
要连接到的Kafka broker的列表；</p>
</li>
<li>
<p><mark>SCHEMA_REGISTRY_LISTNERS</mark>：默认默认http://0.0.0.0.8081，<br>
支持Http或Https的Api请求的监听器的逗号分隔列表；</p>
</li>
<li>
<p>其它属性：https://docs.confluent.io/platform/current/schema-registry/installation/config.html</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker_compose"><a class="anchor" href="#_docker_compose"></a>6. Docker Compose</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>请严格按照官方配置进行安装配置：</p>
</li>
<li>
<p><a href="https://github.com/apache/kafka/blob/trunk/docker/examples" class="bare">https://github.com/apache/kafka/blob/trunk/docker/examples</a></p>
</li>
<li>
<p>如：./jvm/single-node/plaintext/docker-compose.yml</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">version: '3.8'
services:
  kafka:
    image: apache/kafka:3.8.0
    container_name: kafka
    privileged: true
    hostname: kafka
    ports:
      - "9092:9092"
    environment:
      KAFKA_NODE_ID: 1
      KAFKA_LOG_DIRS: '/tmp/kafka-log'
      CLUSTER_ID: 'YWU3MzE1YmVmYzhiMTFlZT'

      KAFKA_PROCESS_ROLES: 'broker,controller'
      KAFKA_INTER_BROKER_LISTENER_NAME: 'PLAINTEXT'
      KAFKA_CONTROLLER_LISTENER_NAMES: 'CONTROLLER'
      KAFKA_CONTROLLER_QUORUM_VOTERS: '1@kafka:29093'

      KAFKA_LISTENERS: 'CONTROLLER://:29093,PLAINTEXT_HOST://:9092,PLAINTEXT://:19092'
      KAFKA_ADVERTISED_LISTENERS: 'PLAINTEXT_HOST://192.168.0.123:9092,PLAINTEXT://kafka:19092'
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: 'CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT'

      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1
      KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1
networks:
  default:
    name: network-common
    external: true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kraft_server_properties"><a class="anchor" href="#_kraft_server_properties"></a>7. KRaft server.properties</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>因Kafka目前还没到4.X版本，目前只修改了config/server.properties，<br>
并未修改config/kraft/server.properties</p>
</li>
<li>
<p>若不修改kraft/server.properties，则可能出现各种奇奇怪怪的问题，<br>
如能发送消息，但不能消费等；</p>
</li>
<li>
<p>当然也可通过数据卷映射：<br>
/elf/kafka/kraft:/opt/kafka/config/kraft</p>
</li>
<li>
<p>也可自定义Docker镜像：<br>
<a href="https://blog.csdn.net/Vector97/article/details/128237505" class="bare">https://blog.csdn.net/Vector97/article/details/128237505</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker compose up -d

docker exec -it kafka /bin/bash

cd /opt/kafka/config/kraft

vi server.properties</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">#controller.quorum.voters=1@localhost:9093
controller.quorum.voters=1@192.168.0.123:9093

#listeners=PLAINTEXT://:9092,CONTROLLER://:9093
listeners=CONTROLLER://:29093,PLAINTEXT_HOST://:9092,PLAINTEXT://:19092

#advertised.listeners=PLAINTEXT://localhost:9092
advertised.listeners=PLAINTEXT_HOST://192.168.0.123:9092,PLAINTEXT://kafka:19092</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker compose stop

docker compose start</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_on_linux"><a class="anchor" href="#_install_on_linux"></a>8. Install On Linux</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>安装Jdk17，下载并解压Kafka；</p>
</li>
<li>
<p>Generate Cluster Id：<mark>./bin/kafka-storage.sh random-uuid</mark></p>
</li>
<li>
<p>Format Storage Directory(替换UUID)：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">.bin/kafka-storage.sh format -t &lt;uuid&gt; -c ~/config/kraft/server.properties</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>这将格式化config/kraft/server.properties文件中<br>
log.dirs中的目录，默认为/tmp/kraft-combined-logs；</p>
</li>
<li>
<p>启动broker，不要关闭Shell窗口，因它回关闭Broker：</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./bin/kafka-server-start.sh ~/config/kraft/server.properties</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>设置PATH：<mark>PATH="$PATH:/elf/kafka/bin"</mark>；</p>
</li>
<li>
<p><mark>kafka-topics.sh</mark></p>
</li>
</ul>
</div>
</div>
</div>
</article>
	</div>
</main>
</div>
		<footer class="footer">
	
	
	
	<div class="footer-thanks">
		Authored in AsciiDoc
		<br /><br />
		Produced by Antora and Asciidoctor
  	</div>
  
	<div class="footer-legal" style="text-align:center">
		Gitee：<a href="https://gitee.com/iRecursion" 
			target="_blank">https://gitee.com/iRecursion</a>
		
		<br /><br />
		
		Github：<a href="https://github.com/iRecursion" 
			target="_blank">https://github.com/iRecursion</a>
	</div>
  
	<div class="footer-thanks" style="text-align:left">
		Copyright © 2024 Elf
		<br /><br />
		<address>
			Mailto：<a href="mailto:2032047511@qq.com">2032047511@qq.com</a>
		</address>
	</div>
	
</footer><script id="site-script" src="../../../../_/js/site.js" 
	data-ui-root-path="../../../../_"></script>

<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>


<script async src="../../../../_/js/vendor/prism-1.29.0-coy.js"></script>
  	</body>
</html>
